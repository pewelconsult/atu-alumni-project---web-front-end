<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="bg-gradient-to-r from-secondary to-accent text-white rounded-2xl shadow-lg p-6 mb-8 slide-in relative overflow-hidden">
    <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-32 translate-x-32"></div>
    <div class="relative z-10">
      <h1 class="text-3xl font-bold mb-2">ATU Alumni Forum</h1>
      <p class="opacity-90">Connect, share ideas, and discuss with fellow ATU alumni</p>
    </div>
  </div>

  <!-- Forum Controls -->
  <div class="bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100 slide-in">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <!-- Search Bar -->
      <div class="relative flex-1 max-w-md">
        <input 
          type="text" 
          [(ngModel)]="searchQuery"
          (keyup.enter)="onSearch()"
          placeholder="Search discussions..." 
          class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm">
        <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
      </div>
      
      <!-- New Topic Button -->
      <button 
        (click)="navigateToCreateForum()"
        class="bg-gradient-to-r from-primary to-accent text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all duration-300 font-medium flex items-center">
        <i class="fas fa-plus mr-2"></i>
        New Topic
      </button>
    </div>
    
    <!-- Category Filters -->
    <div class="flex flex-wrap gap-2 mt-6">
      <button 
        (click)="filterByCategory(null)"
        [class.bg-primary]="selectedCategory === null"
        [class.text-white]="selectedCategory === null"
        [class.bg-gray-100]="selectedCategory !== null"
        [class.text-gray-700]="selectedCategory !== null"
        class="px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors duration-300">
        All Topics
      </button>
      <button 
        *ngFor="let category of categories"
        (click)="filterByCategory(category.id)"
        [class.bg-primary]="selectedCategory === category.id"
        [class.text-white]="selectedCategory === category.id"
        [class.bg-gray-100]="selectedCategory !== category.id"
        [class.text-gray-700]="selectedCategory !== category.id"
        class="px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors duration-300 text-sm">
        {{ category.name }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage && !isLoading" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6">
    {{ errorMessage }}
  </div>

  <!-- No Results -->
  <div *ngIf="!isLoading && posts.length === 0" class="text-center py-12">
    <i class="fas fa-comments text-6xl text-gray-300 mb-4"></i>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">No discussions found</h3>
    <p class="text-gray-500">Try adjusting your search or filters, or create a new topic!</p>
  </div>

  <!-- Forum Topics Grid -->
  <!-- Forum Topics Grid -->
<div *ngIf="!isLoading && posts.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
  <div 
    *ngFor="let post of posts; let i = index"
    (click)="viewPost(post)"
    class="bg-white rounded-2xl shadow-sm hover:shadow-md transition-all duration-300 p-4 card-hover slide-in border cursor-pointer relative"
    [class.border-yellow-200]="post.is_pinned"
    [class.border-2]="post.is_pinned"
    [class.border-gray-100]="!post.is_pinned"
    [style.animation-delay]="(i * 0.1) + 's'">
    
    <!-- Pinned Badge -->
    <div *ngIf="post.is_pinned" class="absolute -top-2 -left-2 w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center text-white text-xs">
      <i class="fas fa-thumbtack"></i>
    </div>
    
    <!-- Category and Status Badges -->
    <div class="flex items-center space-x-2 mb-3">
      <span 
        *ngIf="post.is_pinned"
        class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-lg text-xs font-medium">
        Pinned
      </span>
      <span 
        class="px-2 py-1 rounded-lg text-xs font-medium"
        [style.background-color]="getCategoryColor(post.category_id) + '20'"
        [style.color]="getCategoryColor(post.category_id)">
        {{ post.category_name || getCategoryName(post.category_id) }}
      </span>
      <span 
        *ngIf="post.is_locked"
        class="bg-gray-100 text-gray-700 px-2 py-1 rounded-lg text-xs font-medium">
        <i class="fas fa-lock mr-1"></i>Locked
      </span>
    </div>
    
    <!-- Post Title and Content -->
    <h3 class="text-lg font-bold text-gray-800 mb-2 line-clamp-2">{{ post.title }}</h3>
    <p class="text-gray-600 text-sm mb-4 line-clamp-2">{{ post.content }}</p>
    
    <!-- Author and Stats -->
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <!-- Updated Author Avatar with Image -->
        <div *ngIf="hasProfilePicture(post.author_picture); else authorInitials"
             class="w-8 h-8 rounded-lg overflow-hidden shadow-sm border border-gray-200">
          <img [src]="getProfilePictureUrl(post.author_picture)" 
               [alt]="post.author_name" 
               class="w-full h-full object-cover">
        </div>
        <ng-template #authorInitials>
          <div class="w-8 h-8 bg-gradient-to-r from-primary to-accent rounded-lg flex items-center justify-center text-white text-xs font-bold shadow-sm">
            {{ getAuthorInitials(post.author_name || 'User') }}
          </div>
        </ng-template>
        
        <div class="text-xs text-gray-500">
          <p class="font-medium text-gray-700">{{ post.author_name || 'Anonymous' }}</p>
          <p>{{ getTimeAgo(post.created_at) }}</p>
        </div>
      </div>
      
      <div class="flex items-center space-x-3 text-xs text-gray-500">
        <div class="flex items-center">
          <i class="fas fa-eye mr-1"></i>
          <span>{{ post.views_count }}</span>
        </div>
        <div class="flex items-center">
          <i class="fas fa-comment mr-1"></i>
          <span>{{ post.replies_count }}</span>
        </div>
        <button 
          (click)="toggleLike(post, $event)"
          class="flex items-center hover:text-red-500 transition-colors"
          [class.text-red-500]="post.user_has_liked">
          <i [class.fas]="post.user_has_liked" [class.far]="!post.user_has_liked" class="fa-heart mr-1"></i>
          <span>{{ post.likes_count }}</span>
        </button>
      </div>
    </div>

    <!-- Tags -->
    <div *ngIf="post.tags && post.tags.length > 0" class="flex flex-wrap gap-1 mt-3">
      <span 
        *ngFor="let tag of post.tags.slice(0, 3)"
        class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">
        #{{ tag }}
      </span>
    </div>
  </div>
</div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && posts.length > 0" class="flex justify-center items-center space-x-2 mt-8">
    <button 
      (click)="goToPage(currentPage - 1)"
      [disabled]="currentPage === 1"
      [class.opacity-50]="currentPage === 1"
      [class.cursor-not-allowed]="currentPage === 1"
      class="w-10 h-10 flex items-center justify-center bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors duration-300">
      <i class="fas fa-chevron-left"></i>
    </button>

    <button 
      *ngFor="let page of getPaginationPages()"
      (click)="page !== -1 && goToPage(page)"
      [class.bg-primary]="page === currentPage"
      [class.text-white]="page === currentPage"
      [class.bg-gray-100]="page !== currentPage && page !== -1"
      [class.text-gray-600]="page !== currentPage && page !== -1"
      [disabled]="page === -1"
      class="w-10 h-10 flex items-center justify-center rounded-lg hover:bg-gray-200 transition-colors duration-300">
      <span *ngIf="page !== -1">{{ page }}</span>
      <span *ngIf="page === -1">...</span>
    </button>

    <button 
      (click)="goToPage(currentPage + 1)"
      [disabled]="currentPage === totalPages"
      [class.opacity-50]="currentPage === totalPages"
      [class.cursor-not-allowed]="currentPage === totalPages"
      class="w-10 h-10 flex items-center justify-center bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors duration-300">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</div>