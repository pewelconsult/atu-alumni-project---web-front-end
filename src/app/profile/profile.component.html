<div class="container mx-auto px-4 py-8" *ngIf="!loading; else loadingTemplate">
  <!-- Error State -->
  <div *ngIf="error" class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6">
    {{ error }}
  </div>

  <!-- Profile Content -->
  <div *ngIf="user">
    <!-- Header -->
    <div class="bg-gradient-to-r from-primary to-accent text-white rounded-2xl shadow-lg p-6 mb-8 slide-in relative overflow-hidden">
      <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-32 translate-x-32"></div>
      <div class="relative z-10">
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold mb-2">My Profile</h1>
            <p class="opacity-90">Manage your profile and connect with alumni</p>
          </div>
          <button 
            (click)="toggleEdit()" 
            class="mt-4 md:mt-0 bg-white text-primary px-6 py-3 rounded-xl hover:bg-opacity-90 transition-colors duration-300 font-medium flex items-center space-x-2">
            <i class="fas fa-edit"></i>
            <span>{{ isEditing ? 'Cancel' : 'Edit Profile' }}</span>
          </button>
        </div>
      </div>
    </div>

    <div class="flex flex-col lg:flex-row gap-6">
      <!-- Left Sidebar - Profile Info -->
      <div class="w-full lg:w-1/3 space-y-6">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
          <div class="bg-gradient-to-r from-primary to-accent p-6 text-white text-center">
            <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center text-primary font-bold text-2xl mx-auto mb-4">
              {{ getInitials() }}
            </div>
            <h2 class="text-xl font-bold">{{ user.first_name }} {{ user.last_name }}</h2>
            <p class="opacity-90">{{ user.job_title || 'Alumni' }}</p>
            <p class="text-sm opacity-80 mt-1" *ngIf="user.program_of_study && user.graduation_year">
              {{ user.program_of_study }}, {{ user.graduation_year }}
            </p>
          </div>

          <div class="p-6">
            <div class="grid grid-cols-3 gap-4 text-center mb-6">
              <div>
                <p class="font-bold text-primary text-lg">—</p>
                <p class="text-gray-500 text-sm">Connections</p>
              </div>
              <div>
                <p class="font-bold text-primary text-lg">—</p>
                <p class="text-gray-500 text-sm">Events</p>
              </div>
              <div>
                <p class="font-bold text-primary text-lg">—</p>
                <p class="text-gray-500 text-sm">Forums</p>
              </div>
            </div>

            <div class="space-y-4">
              <div class="flex items-center" *ngIf="user.current_city || user.current_country">
                <i class="fas fa-map-marker-alt text-gray-400 w-5"></i>
                <span class="ml-3 text-gray-600">
                  {{ user.current_city }}{{ user.current_city && user.current_country ? ', ' : '' }}{{ user.current_country }}
                </span>
              </div>
              <div class="flex items-center" *ngIf="user.current_company">
                <i class="fas fa-building text-gray-400 w-5"></i>
                <span class="ml-3 text-gray-600">{{ user.current_company }}</span>
              </div>
              <div class="flex items-center" *ngIf="user.show_email && user.email">
                <i class="fas fa-envelope text-gray-400 w-5"></i>
                <span class="ml-3 text-gray-600">{{ user.email }}</span>
              </div>
              <div class="flex items-center" *ngIf="user.show_phone && user.phone_number">
                <i class="fas fa-phone text-gray-400 w-5"></i>
                <span class="ml-3 text-gray-600">{{ user.phone_number }}</span>
              </div>
            </div>

            <button class="w-full mt-6 bg-primary text-white py-3 rounded-xl hover:bg-opacity-90 transition-colors duration-300 font-medium">
              <i class="fas fa-share-alt mr-2"></i>
              Share Profile
            </button>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="w-full lg:w-2/3 space-y-6">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h3 class="font-bold text-xl text-gray-800 mb-4">About</h3>
          <p class="text-gray-600 mb-6" *ngIf="user.bio; else noBio">
            {{ user.bio }}
          </p>
          <ng-template #noBio>
            <p class="text-gray-400 italic">No bio added yet.</p>
          </ng-template>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- Education -->
            <div>
              <h4 class="font-bold text-gray-800 mb-3">Education</h4>
              <div class="space-y-3" *ngIf="user.program_of_study || user.graduation_year; else noEdu">
                <div class="flex items-start space-x-3">
                  <div class="w-10 h-10 bg-gradient-to-r from-primary to-accent rounded-lg flex items-center justify-center text-white">
                    <i class="fas fa-graduation-cap"></i>
                  </div>
                  <div>
                    <p class="font-medium">Your University</p>
                    <p class="text-sm text-gray-500">
                      {{ user.program_of_study }} {{ user.major ? ', ' + user.major : '' }}
                      <span *ngIf="user.graduation_year">({{ user.graduation_year }})</span>
                    </p>
                  </div>
                </div>
              </div>
              <ng-template #noEdu>
                <p class="text-gray-400 text-sm">No education info</p>
              </ng-template>
            </div>

            <!-- Experience -->
            <div>
              <h4 class="font-bold text-gray-800 mb-3">Experience</h4>
              <div class="space-y-3" *ngIf="user.current_company || user.job_title; else noExp">
                <div class="flex items-start space-x-3">
                  <div class="w-10 h-10 bg-gradient-to-r from-accent to-secondary rounded-lg flex items-center justify-center text-white">
                    <i class="fas fa-briefcase"></i>
                  </div>
                  <div>
                    <p class="font-medium">{{ user.current_company }}</p>
                    <p class="text-sm text-gray-500">
                      {{ user.job_title }} 
                      <span *ngIf="user.years_of_experience">• {{ user.years_of_experience }} yrs</span>
                    </p>
                  </div>
                </div>
              </div>
              <ng-template #noExp>
                <p class="text-gray-400 text-sm">No experience added</p>
              </ng-template>
            </div>
          </div>

          <!-- Skills -->
          <div class="bg-gray-50 rounded-xl p-4" *ngIf="user.skills && user.skills.length > 0">
            <h4 class="font-bold text-gray-800 mb-3">Skills and Expertise</h4>
            <div class="flex flex-wrap gap-2">
              <span *ngFor="let skill of user.skills"
                    class="bg-blue-50 text-blue-700 px-3 py-2 rounded-lg text-sm border border-blue-100">
                {{ skill }}
              </span>
            </div>
          </div>
        </div>

        <!-- Edit Form (Hidden until edit mode) -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6" *ngIf="isEditing">
          <h3 class="font-bold text-xl text-gray-800 mb-4">Edit Profile</h3>
          <form (ngSubmit)="saveProfile()" #profileForm="ngForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input type="text" [(ngModel)]="editForm.first_name" name="first_name"
                     placeholder="First Name" class="input-field" required>
              <input type="text" [(ngModel)]="editForm.last_name" name="last_name"
                     placeholder="Last Name" class="input-field" required>
              <input type="text" [(ngModel)]="editForm.phone_number" name="phone_number"
                     placeholder="Phone Number" class="input-field md:col-span-2">
              <input type="text" [(ngModel)]="editForm.current_company" name="current_company"
                     placeholder="Current Company" class="input-field">
              <input type="text" [(ngModel)]="editForm.job_title" name="job_title"
                     placeholder="Job Title" class="input-field">
              <input type="text" [(ngModel)]="editForm.current_city" name="current_city"
                     placeholder="City" class="input-field">
              <input type="text" [(ngModel)]="editForm.current_country" name="current_country"
                     placeholder="Country" class="input-field">
            </div>
            <textarea [(ngModel)]="editForm.bio" name="bio" rows="4"
                      placeholder="Tell us about yourself..." class="input-field w-full"></textarea>

            <div class="flex gap-3">
              <button type="submit" class="bg-primary text-white px-6 py-3 rounded-xl font-medium">
                Save Changes
              </button>
              <button type="button" (click)="cancelEdit()" class="bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-medium">
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <div class="flex justify-center items-center py-20">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
  </div>
</ng-template>