<!-- src/app/admin/add-user/add-user.component.html -->

<div class="min-h-screen bg-gray-50">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Main Content -->
  <div class="lg:ml-64 transition-all duration-300">
    <div class="p-4 md:p-6 lg:p-8">
      <div class="container mx-auto max-w-4xl">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-primary to-accent text-white rounded-2xl shadow-lg p-5 mb-6 slide-in relative overflow-hidden">
          <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -translate-y-32 translate-x-32"></div>
          <div class="relative z-10">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
              <div>
                <h1 class="text-2xl font-bold mb-2">Add New User</h1>
                <p class="opacity-90 text-sm">Create a new user account in the alumni network</p>
              </div>
              <div class="flex space-x-3 mt-4 md:mt-0">
                <button 
                  type="button"
                  (click)="navigateBackToUsers()" 
                  class="bg-white/20 text-white px-4 py-2.5 rounded-xl hover:bg-white/30 transition-all duration-300 font-medium text-sm border border-white/30 flex items-center">
                  <i class="fas fa-arrow-left mr-2"></i>Back
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Success Message -->
        <div *ngIf="successMessage" 
             class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-xl mb-4 flex items-center animate-fade-in">
          <i class="fas fa-check-circle mr-2 text-lg"></i>
          <span>{{ successMessage }}</span>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" 
             class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-4 flex items-center animate-fade-in">
          <i class="fas fa-exclamation-circle mr-2 text-lg"></i>
          <span>{{ errorMessage }}</span>
        </div>

        <!-- Progress Steps -->
        <div class="bg-white rounded-xl shadow-sm p-5 mb-6 border border-gray-100">
          <div class="flex items-center justify-between max-w-2xl mx-auto">
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold text-sm">1</div>
              <span class="text-xs mt-2 font-medium text-primary">Account Info</span>
            </div>
            <div class="h-1 flex-1 bg-primary mx-2"></div>
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold text-sm">2</div>
              <span class="text-xs mt-2 font-medium text-primary">Profile Details</span>
            </div>
            <div class="h-1 flex-1 bg-gray-200 mx-2"></div>
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold text-sm">3</div>
              <span class="text-xs mt-2 font-medium text-gray-500">Review</span>
            </div>
          </div>
        </div>

        <!-- User Form -->
        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 mb-6">
          <h2 class="text-lg font-bold text-gray-800 mb-6">User Information</h2>
          
          <form [formGroup]="userForm" (ngSubmit)="onSubmit()" id="addUserForm">
            
            <!-- ==================== BASIC INFORMATION ==================== -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <!-- First Name -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  First Name <span class="text-red-500">*</span>
                </label>
                <input 
                  type="text"
                  formControlName="first_name"
                  class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                  [class.border-red-500]="hasError('first_name')"
                  [class.border-gray-300]="!hasError('first_name')"
                  placeholder="Enter first name"
                >
                <div *ngIf="hasError('first_name')" class="mt-1">
                  <span *ngIf="hasError('first_name', 'required')" class="text-red-500 text-xs">
                    First name is required
                  </span>
                  <span *ngIf="hasError('first_name', 'minlength')" class="text-red-500 text-xs">
                    Minimum 2 characters required
                  </span>
                </div>
              </div>
              
              <!-- Last Name -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Last Name <span class="text-red-500">*</span>
                </label>
                <input 
                  type="text"
                  formControlName="last_name"
                  class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                  [class.border-red-500]="hasError('last_name')"
                  [class.border-gray-300]="!hasError('last_name')"
                  placeholder="Enter last name"
                >
                <div *ngIf="hasError('last_name')" class="mt-1">
                  <span *ngIf="hasError('last_name', 'required')" class="text-red-500 text-xs">
                    Last name is required
                  </span>
                  <span *ngIf="hasError('last_name', 'minlength')" class="text-red-500 text-xs">
                    Minimum 2 characters required
                  </span>
                </div>
              </div>
            </div>

            <!-- ==================== EMAIL & PHONE ==================== -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <!-- Email -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Email Address <span class="text-red-500">*</span>
                </label>
                <input 
                  type="email"
                  formControlName="email"
                  class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                  [class.border-red-500]="hasError('email')"
                  [class.border-gray-300]="!hasError('email')"
                  placeholder="user@example.com"
                >
                <div *ngIf="hasError('email')" class="mt-1">
                  <span *ngIf="hasError('email', 'required')" class="text-red-500 text-xs">
                    Email is required
                  </span>
                  <span *ngIf="hasError('email', 'email')" class="text-red-500 text-xs">
                    Invalid email format
                  </span>
                </div>
              </div>
              
              <!-- Phone Number -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                <input 
                  type="tel"
                  formControlName="phone_number"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                  placeholder="+233 XX XXX XXXX"
                >
              </div>
            </div>

            <!-- ==================== PASSWORD ROW ==================== -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <!-- Password -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Password <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                  <input 
                    [type]="showPassword ? 'text' : 'password'"
                    formControlName="password"
                    class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm pr-10"
                    [class.border-red-500]="hasError('password')"
                    [class.border-gray-300]="!hasError('password')"
                    placeholder="Enter password"
                  >
                  <button 
                    type="button"
                    (click)="togglePasswordVisibility('password')"
                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600">
                    <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                  </button>
                </div>
                <div *ngIf="hasError('password')" class="mt-1">
                  <span *ngIf="hasError('password', 'required')" class="text-red-500 text-xs">
                    Password is required
                  </span>
                  <span *ngIf="hasError('password', 'minlength')" class="text-red-500 text-xs">
                    Password must be at least 6 characters
                  </span>
                </div>
              </div>
              
              <!-- Confirm Password -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Confirm Password <span class="text-red-500">*</span>
                </label>
                <div class="relative">
                  <input 
                    [type]="showConfirmPassword ? 'text' : 'password'"
                    formControlName="confirmPassword"
                    class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm pr-10"
                    [class.border-red-500]="hasError('confirmPassword') || userForm.hasError('passwordMismatch')"
                    [class.border-gray-300]="!hasError('confirmPassword') && !userForm.hasError('passwordMismatch')"
                    placeholder="Confirm password"
                  >
                  <button 
                    type="button"
                    (click)="togglePasswordVisibility('confirmPassword')"
                    class="absolute right-3 top-3 text-gray-400 hover:text-gray-600">
                    <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
                  </button>
                </div>
                <div *ngIf="hasError('confirmPassword') || userForm.hasError('passwordMismatch')" class="mt-1">
                  <span *ngIf="hasError('confirmPassword', 'required')" class="text-red-500 text-xs">
                    Please confirm your password
                  </span>
                  <span *ngIf="userForm.hasError('passwordMismatch') && !hasError('confirmPassword', 'required')" class="text-red-500 text-xs">
                    Passwords do not match
                  </span>
                </div>
              </div>
            </div>

            <!-- ==================== ROLE & STATUS ==================== -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <!-- User Role -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  User Role <span class="text-red-500">*</span>
                </label>
                <select 
                  formControlName="role"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none bg-white text-sm">
                  <option value="">Select user role</option>
                  <option value="admin">Administrator</option>
                  <option value="alumni">Alumni</option>
                  <option value="staff">Staff</option>
                </select>
                <div *ngIf="hasError('role')" class="mt-1">
                  <span class="text-red-500 text-xs">User role is required</span>
                </div>
              </div>
              
              <!-- Student ID -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Student/Index Number</label>
                <input 
                  type="text"
                  formControlName="student_id"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                  placeholder="e.g., CS2020001"
                >
              </div>
            </div>

            <!-- ==================== ACADEMIC INFORMATION ==================== -->
            <div class="mb-6">
              <h3 class="text-md font-medium text-gray-800 mb-4 flex items-center">
                <i class="fas fa-graduation-cap mr-2 text-primary"></i>
                Academic Information
              </h3>
              
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Faculty -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Faculty</label>
                  <select 
                    formControlName="faculty"
                    (change)="onFacultyChange($event)"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none bg-white text-sm">
                    <option value="">Select Faculty</option>
                    <option *ngFor="let faculty of dropdownData?.faculties" [value]="faculty.id">
                      {{ faculty.name }}
                    </option>
                  </select>
                </div>
                
                <!-- Department -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Department</label>
                  <select 
                    formControlName="department"
                    (change)="onDepartmentChange($event)"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none bg-white text-sm">
                    <option value="">Select Department</option>
                    <option *ngFor="let dept of dropdownData?.departments" [value]="dept.id">
                      {{ dept.name }}
                    </option>
                  </select>
                </div>
                
                <!-- Program -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Program</label>
                  <select 
                    formControlName="program_of_study"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none bg-white text-sm">
                    <option value="">Select Program</option>
                    <option *ngFor="let program of dropdownData?.programs" [value]="program.name">
                      {{ program.name }}
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <!-- ==================== GRADUATION YEAR ==================== -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Graduation Year</label>
                <select 
                  formControlName="graduation_year"
                  class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none bg-white text-sm">
                  <option value="">Select Year</option>
                  <option *ngFor="let year of graduationYears" [value]="year">{{ year }}</option>
                </select>
              </div>
            </div>

            <!-- ==================== PROFESSIONAL INFORMATION ==================== -->
            <div class="mb-6">
              <h3 class="text-md font-medium text-gray-800 mb-4 flex items-center">
                <i class="fas fa-briefcase mr-2 text-primary"></i>
                Professional Information
              </h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Job Title -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Current Job Title</label>
                  <input 
                    type="text"
                    formControlName="job_title"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                    placeholder="e.g., Software Engineer"
                  >
                </div>
                
                <!-- Company -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Company/Organization</label>
                  <input 
                    type="text"
                    formControlName="current_company"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                    placeholder="e.g., Tech Solutions Inc."
                  >
                </div>
              </div>
            </div>

            <!-- ==================== LOCATION INFORMATION ==================== -->
            <div class="mb-6">
              <h3 class="text-md font-medium text-gray-800 mb-4 flex items-center">
                <i class="fas fa-map-marker-alt mr-2 text-primary"></i>
                Location Information
              </h3>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Current City -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Current City</label>
                  <input 
                    type="text"
                    formControlName="current_city"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-sm"
                    placeholder="e.g., Accra"
                  >
                </div>
                
                <!-- Country -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                  <select 
                    formControlName="current_country"
                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent appearance-none bg-white text-sm">
                    <option *ngFor="let country of countries" [value]="country.value">
                      {{ country.label }}
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <!-- ==================== ADDITIONAL SETTINGS ==================== -->
            <div class="mb-6">
              <h3 class="text-md font-medium text-gray-800 mb-4 flex items-center">
                <i class="fas fa-cog mr-2 text-primary"></i>
                Additional Settings
              </h3>
              
              <div class="space-y-4">
                <!-- Email Verification -->
                <div class="flex items-center justify-between">
                  <div>
                    <label class="text-sm font-medium text-gray-700">Email Verification Required</label>
                    <p class="text-xs text-gray-500">User must verify email before login</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input 
                      type="checkbox"
                      formControlName="email_verified"
                      class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                  </label>
                </div>
                
                <!-- Send Welcome Email -->
                <div class="flex items-center justify-between">
                  <div>
                    <label class="text-sm font-medium text-gray-700">Send Welcome Email</label>
                    <p class="text-xs text-gray-500">Send account details to user</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input 
                      type="checkbox"
                      formControlName="send_welcome_email"
                      class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                  </label>
                </div>
                
                <!-- Add to Mailing List -->
                <div class="flex items-center justify-between">
                  <div>
                    <label class="text-sm font-medium text-gray-700">Add to Mailing List</label>
                    <p class="text-xs text-gray-500">Subscribe to alumni newsletter</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input 
                      type="checkbox"
                      formControlName="add_to_mailing_list"
                      class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                  </label>
                </div>

                <!-- Account Active -->
                <div class="flex items-center justify-between">
                  <div>
                    <label class="text-sm font-medium text-gray-700">Account Active</label>
                    <p class="text-xs text-gray-500">User can login immediately</p>
                  </div>
                  <label class="relative inline-flex items-center cursor-pointer">
                    <input 
                      type="checkbox"
                      formControlName="is_active"
                      class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                  </label>
                </div>
              </div>
            </div>

            <!-- ==================== PROFILE PHOTO ==================== -->
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-camera mr-2"></i>Profile Photo
              </label>
              <div class="flex flex-col sm:flex-row items-start sm:items-center gap-6">
                <!-- Preview -->
                <div class="w-24 h-24 bg-gray-200 rounded-xl flex items-center justify-center text-gray-400 overflow-hidden">
                  <img 
                    *ngIf="previewUrl" 
                    [src]="previewUrl" 
                    alt="Preview"
                    class="w-full h-full object-cover">
                  <i *ngIf="!previewUrl" class="fas fa-user text-2xl"></i>
                </div>
                
                <!-- Upload Area -->
                <div class="flex-1 w-full">
                  <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-primary transition-colors duration-300">
                    <div class="flex flex-col items-center justify-center">
                      <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-3"></i>
                      <p class="text-sm text-gray-600 mb-1">Drag & drop your photo here</p>
                      <p class="text-xs text-gray-500 mb-4">or</p>
                      <label class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-opacity-90 transition-colors duration-300 text-sm font-medium cursor-pointer">
                        Browse Files
                        <input 
                          type="file"
                          accept="image/*"
                          (change)="onFileSelected($event)"
                          class="hidden">
                      </label>
                      <p class="text-xs text-gray-500 mt-3">PNG, JPG up to 2MB</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ==================== FORM ACTIONS ==================== -->
            <div class="flex flex-col sm:flex-row justify-between items-center pt-6 border-t border-gray-200 gap-4">
              <div class="text-sm text-gray-500">
                <i class="fas fa-info-circle mr-1"></i>
                All fields marked with <span class="text-red-500">*</span> are required
              </div>
              <div class="flex space-x-3">
                <button 
                  type="button"
                  (click)="saveAsDraft()"
                  [disabled]="isLoading"
                  class="px-6 py-3 border border-gray-300 rounded-xl hover:bg-gray-50 transition-colors duration-300 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                  <i class="fas fa-save mr-2"></i>Save as Draft
                </button>
                <button 
                  type="submit"
                  [disabled]="isLoading || userForm.invalid"
                  class="bg-primary text-white px-6 py-3 rounded-xl hover:bg-opacity-90 transition-colors duration-300 text-sm font-medium flex items-center disabled:opacity-50 disabled:cursor-not-allowed">
                  <i *ngIf="!isLoading" class="fas fa-user-plus mr-2"></i>
                  <i *ngIf="isLoading" class="fas fa-spinner fa-spin mr-2"></i>
                  {{ isLoading ? 'Creating...' : 'Create User' }}
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Quick Tips -->
        <div class="bg-blue-50 rounded-xl p-5 border border-blue-100">
          <h3 class="text-md font-medium text-blue-800 mb-3 flex items-center">
            <i class="fas fa-lightbulb mr-2"></i>User Creation Tips
          </h3>
          <ul class="text-sm text-blue-700 space-y-2">
            <li class="flex items-start">
              <i class="fas fa-check-circle mr-2 mt-0.5 text-blue-500"></i>
              Use official email addresses when possible for better deliverability
            </li>
            <li class="flex items-start">
              <i class="fas fa-check-circle mr-2 mt-0.5 text-blue-500"></i>
              Set strong passwords that meet security requirements (minimum 6 characters)
            </li>
            <li class="flex items-start">
              <i class="fas fa-check-circle mr-2 mt-0.5 text-blue-500"></i>
              Verify academic information with official records when available
            </li>
            <li class="flex items-start">
              <i class="fas fa-check-circle mr-2 mt-0.5 text-blue-500"></i>
              Enable email verification for enhanced security
            </li>
          </ul>
        </div>

      </div>
    </div>
  </div>
</div>